# CHAPTER 8. DESIGN A URL SHORTENER(URL λ‹¨μ¶•κΈ° μ„¤κ³„)
> κ°€μƒ λ©΄μ ‘μΌλ΅ λ°°μ°λ” λ€κ·λ¨ μ‹μ¤ν… μ„¤κ³„ κΈ°μ΄(System Design Interview - An Insider's Guide: Alex Xu λ²μ—­λ³Έ)

&nbsp;κ³ μ „μ μΈ μ‹μ¤ν… μ„¤κ³„ λ¬Έμ  κ°€μ΄λ° ν•λ‚μΈ, [TinyURL](https://tinyurl.com/) κ°™μ€ URL λ‹¨μ¶•κΈ°λ¥Ό μ„¤κ³„ν•λ” λ¬Έμ λ¥Ό ν’€μ–΄λ³΄λ” κ²ƒμ„ μ •λ¦¬.

### π STEP 1 - λ¬Έμ  μ΄ν•΄ λ° μ„¤κ³„ λ²”μ„ ν™•μ •
#### π’΅ κ°λµμ  μ¶”μ •
* μ“°κΈ° μ—°μ‚°: λ§¤μΌ 1μ–µ κ°μ λ‹¨μ¶• URL μƒμ„±
* μ΄λ‹Ή μ“°κΈ° μ—°μ‚°: 1μ–µ(100million) / 24 / 3600 = 1160
* μ½κΈ° μ—°μ‚°: μ½κΈ° μ—°μ‚°κ³Ό μ“°κΈ° μ—°μ‚° λΉ„μ¨μ€ 10:1μ΄λΌκ³  ν•μ. κ·Έ κ²½μ° μ½κΈ° μ—°μ‚°μ€ μ΄λ‹Ή 11,600ν λ°μƒν•λ‹¤.(1160 * 10 = 11,600)
* URL λ‹¨μ¶• μ„λΉ„μ¤λ¥Ό 10λ…„κ°„ μ΄μν•λ‹¤κ³  κ°€μ •ν•λ©΄ 1μ–µ(100million) * 365 * 10 = 3650μ–µ(365billion)κ°μ λ μ½”λ“λ¥Ό λ³΄κ΄€ν•΄μ•Ό ν•λ‹¤.
* μ¶•μ•½ μ „ URLμ ν‰κ·  κΈΈμ΄λ” 100μ΄λΌκ³  ν•μ.
* λ”°λΌμ„ 10λ…„ λ™μ• ν•„μ”ν• μ €μ¥ μ©λ‰μ€ 3650μ–µ(365billion) * 100byte = 36.5TB μ΄λ‹¤.

### π STEP 2 - κ°λµμ  μ„¤κ³„μ• μ μ‹ λ° λ™μ κµ¬ν•κΈ°
&nbsp;API μ—”λ“ν¬μΈνΈ(endpoint), URL λ¦¬λ””λ ‰μ…, URL λ‹¨μ¶• ν”λ΅μ— λ€ν•΄ μ‚΄ν΄λ³΄μ.

#### π’΅ API μ—”λ“ν¬μΈνΈ
&nbsp;ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ μ κ³µν•λ” API μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μ„λ²„μ™€ ν†µμ‹ ν•λ‹¤. 
μ΄ μ—”λ“ν¬μΈνΈλ¥Ό REST μ¤νƒ€μΌλ΅ μ„¤κ³„ν•  κ²ƒμ΄κ³ , URL λ‹¨μ¶•κΈ°λ” κΈ°λ³Έμ μΌλ΅ λ‘ κ°μ μ—”λ“ν¬μΈνΈλ¥Ό ν•„μ”λ΅ ν•λ‹¤.
1. URL λ‹¨μ¶•μ© μ—”λ“ν¬μΈνΈ: μƒ λ‹¨μ¶• URLμ„ μƒμ„±ν•κ³ μ ν•λ” ν΄λΌμ΄μ–ΈνΈλ” μ΄ μ—”λ“ν¬μΈνΈμ— λ‹¨μ¶•ν•  URLμ„ μΈμλ΅ μ‹¤μ–΄μ„ POST μ”μ²­μ„ λ³΄λ‚΄μ•Ό ν•λ‹¤. μ΄ μ—”λ“ν¬μΈνΈλ” μ•„λμ™€ κ°™μ€ ν•νƒλ¥Ό λλ‹¤. <br><br> _POST/api/v1/data/shorten_ 
    * μΈμ: {longURL: longURLstring}
    * λ°ν™: λ‹¨μ¶• URL
2. URL λ¦¬λ””λ ‰μ…μ© μ—”λ“ν¬μΈνΈ: λ‹¨μ¶• URLμ— λ€ν•΄μ„ HTTP μ”μ²­μ΄ μ¤λ©΄ μ›λ URLλ΅ λ³΄λ‚΄μ£ΌκΈ° μ„ν• μ©λ„μ μ—”λ“ν¬μΈνΈ, μ•„λμ™€ κ°™μ€ ν•νƒλ¥Ό λλ‹¤. <br><br> _GET/api/v1/shortUrl_
    * λ°ν™: HTTP λ¦¬λ””λ ‰μ… λ©μ μ§€κ°€ λ  μ›λ URL  

#### π’΅ URL λ¦¬λ””λ ‰μ…
&nbsp;μ•„λμ μ΄λ―Έμ§€λ¥Ό ν†µν•΄ λ‹¨μ¶• URLμ„ μ…λ ¥ν•λ©΄ μ–΄λ–¤ μΌμ΄ λ°μƒν•λ”μ§€ μ• μ μλ‹¤. 

<img src="https://github.com/ro117-youshin/TIL/blob/main/SystemDesign/img/input_a_short_url.jpg" width="500" height="300"/>

&nbsp;λ‹¨μ¶• URLμ„ λ°›μ€ μ„λ²„λ” κ·Έ URLμ„ μ›λ URLλ΅ λ°”κΎΈμ–΄μ„ 301 μ‘λ‹µμ Location ν—¤λ”μ— λ„£μ–΄ λ°ν™ν•λ‹¤.

&nbsp;ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ μ‚¬μ΄μ ν†µμ‹  μ μ°¨λ¥Ό μΆ€ λ” μμ„Έν λ³΄λ©΄,

<img src="https://github.com/ro117-youshin/TIL/blob/main/SystemDesign/img/the_communication_between_client_and_server.jpg" width="500" height="500"/>

μ—¬κΈ°μ„ μ μν•  κ²ƒμ€ <ins>301 μ‘λ‹µ</ins>κ³Ό <ins>302 μ‘λ‹µ</ins>μ μ°¨μ΄μ΄λ‹¤. λ‘ λ‹¤ λ¦¬λ””λ ‰μ… μ‘λ‹µμ΄κΈ΄ ν•μ§€λ§ μ°¨μ΄κ°€ μλ‹¤.

* **301 Permanently Moved**: μ΄ μ‘λ‹µμ€ <ins>ν•΄λ‹Ή URLμ— λ€ν• HTTP μ”μ²­μ μ²λ¦¬ μ±…μ„μ΄ μκµ¬μ μΌλ΅ Location ν—¤λ”μ— λ°ν™λ URLλ΅ μ΄μ „λμ—λ‹¤λ” μ‘λ‹µ</ins>μ΄λ‹¤. μκµ¬μ μΌλ΅ μ΄μ „λμ—μΌλ―€λ΅, λΈλΌμ°μ €λ” μ΄ μ‘λ‹µμ„ μΊμ‹(cache)ν•λ‹¤. λ”°λΌμ„ μ¶”ν›„ κ°™μ€ λ‹¨μ¶• URLμ— μ”μ²­μ„ λ³΄λ‚Ό ν•„μ”κ°€ μμ„ λ• λΈλΌμ°μ €λ” μΊμ‹λ μ›λ URLλ΅ μ”μ²­μ„ λ³΄λ‚΄κ² λλ‹¤.
<br>&rarr; μ¥μ : μ²« λ²μ§Έ μ”μ²­λ§ λ‹¨μ¶• URLμ„λ²„λ΅ μ „μ†΅λ  κ²ƒμ΄κΈ° λ•λ¬Έμ—, μ„λ²„ λ¶€ν•λ¥Ό μ¤„μ΄λ” κ²ƒμ΄ μ¤‘μ”ν•  λ• μ‚¬μ©ν•λ‹¤.
* **302 Found**: μ΄ μ‘λ‹µμ€ <ins>μ£Όμ–΄μ§„ URLλ΅μ μ”μ²­μ΄ 'μΌμ‹μ μΌλ΅' Location ν—¤λ”κ°€ μ§€μ •ν•λ” URLμ— μν•΄ μ²λ¦¬λμ–΄μ•Ό ν•λ‹¤λ” μ‘λ‹µ</ins>μ΄λ‹¤. λ”°λΌμ„ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ€ μ–Έμ λ‚ λ‹¨μ¶• URL μ„λ²„μ— λ¨Όμ € λ³΄λ‚΄μ§„ ν›„μ— μ›λ URLλ΅ λ¦¬λ””λ ‰μ… λμ–΄μ•Ό ν•λ‹¤.
  <br>&rarr; μ¥μ : νΈλν”½ λ¶„μ„(analytics)μ΄ μ¤‘μ”ν•  λ•, ν΄λ¦­ λ°μƒλ¥ μ΄λ‚ λ°μƒ μ„μΉλ¥Ό μ¶”μ ν•λ”λ° μΆ€ λ” μ λ¦¬ν•λ‹¤.

&nbsp;URL λ¦¬λ””λ ‰μ…μ„ κµ¬ν„ν•λ” κ°€μ¥ μ§κ΄€μ μΈ λ°©λ²•μ€ ν•΄μ‹ ν…μ΄λΈ”μ„ μ‚¬μ©ν•λ” κ²ƒμ΄λ‹¤. ν•΄μ‹ ν…μ΄λΈ”μ— <λ‹¨μ¶• URL, μ›λ URL>μ μμ„ μ €μ¥ν•λ‹¤κ³  κ°€μ •ν•λ‹¤λ©΄, URL λ¦¬λ””λ ‰μ…μ€ μ•„λμ™€ κ°™μ΄ κµ¬ν„λ  μ μλ‹¤.
* μ›λ URL = hashTable.get(λ‹¨μ¶• URL)
* 301 λλ” 302 μ‘λ‹µ Location ν—¤λ”μ— μ›λ URLμ„ λ„£μ€ ν›„ μ „μ†΅

#### π’΅ URL λ‹¨μ¶•

### π STEP 3 - μƒμ„Έ μ„¤κ³„

#### π’΅ λ°μ΄ν„° λ¨λΈ
#### π’΅ ν•΄μ‹ ν•¨μ
#### π’΅ URL λ‹¨μ¶•κΈ° μƒμ„Έ μ„¤κ³„
#### π’΅ URL λ¦¬λ””λ ‰μ… μƒμ„Έ μ„¤κ³„

### π STEP 4 - λ§λ¬΄λ¦¬


#### _Reference_
[1] A RESTful Tutorial: _https://www.restapitutorial.com/index.html_ <br>
[2] Bloom filter: _https://en.wikipedia.org/wiki/Bloom_filter_